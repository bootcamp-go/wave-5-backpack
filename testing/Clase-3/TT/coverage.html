
<!DOCTYPE html>
<html>
	<head>
		<meta http-equiv="Content-Type" content="text/html; charset=utf-8">
		<title>transactions: Go Coverage Report</title>
		<style>
			body {
				background: black;
				color: rgb(80, 80, 80);
			}
			body, pre, #legend span {
				font-family: Menlo, monospace;
				font-weight: bold;
			}
			#topbar {
				background: black;
				position: fixed;
				top: 0; left: 0; right: 0;
				height: 42px;
				border-bottom: 1px solid rgb(80, 80, 80);
			}
			#content {
				margin-top: 50px;
			}
			#nav, #legend {
				float: left;
				margin-left: 10px;
			}
			#legend {
				margin-top: 12px;
			}
			#nav {
				margin-top: 10px;
			}
			#legend span {
				margin: 0 5px;
			}
			.cov0 { color: rgb(192, 0, 0) }
.cov1 { color: rgb(128, 128, 128) }
.cov2 { color: rgb(116, 140, 131) }
.cov3 { color: rgb(104, 152, 134) }
.cov4 { color: rgb(92, 164, 137) }
.cov5 { color: rgb(80, 176, 140) }
.cov6 { color: rgb(68, 188, 143) }
.cov7 { color: rgb(56, 200, 146) }
.cov8 { color: rgb(44, 212, 149) }
.cov9 { color: rgb(32, 224, 152) }
.cov10 { color: rgb(20, 236, 155) }

		</style>
	</head>
	<body>
		<div id="topbar">
			<div id="nav">
				<select id="files">
				
				<option value="file0">goweb/internal/transactions/repository.go (39.4%)</option>
				
				<option value="file1">goweb/internal/transactions/service.go (18.8%)</option>
				
				</select>
			</div>
			<div id="legend">
				<span>not tracked</span>
			
				<span class="cov0">not covered</span>
				<span class="cov8">covered</span>
			
			</div>
		</div>
		<div id="content">
		
		<pre class="file" id="file0" style="display: none">package transactions

import (
        "fmt"
        "goweb/internal/domain"
        "goweb/pkg/store"
)

const (
        ProductNotFound = "product %d not found"
        FailReading     = "cant read database"
        FailWriting     = "cant write database, error: %w"
)

type Repository interface {
        GetAll() ([]domain.Transaction, error)
        Store(id int, tranCode, currency string, amount float64, transmitter, receiver, tranDate string) (domain.Transaction, error)
        LastID() (int, error)
        Update(id int, tranCode, currency string, amount float64, transmitter, receiver, tranDate string) (domain.Transaction, error)
        Delete(id int) error
        UpdateCodeAmount(id int, tranCode string, amount float64) (domain.Transaction, error)
}

type repository struct {
        db store.Store
}

func NewRepository(db store.Store) Repository <span class="cov8" title="1">{

        return &amp;repository{
                db: db,
        }
}</span>

func (r *repository) GetAll() ([]domain.Transaction, error) <span class="cov0" title="0">{
        var lista []domain.Transaction

        if err := r.db.Read(&amp;lista); err != nil </span><span class="cov0" title="0">{
                return nil, fmt.Errorf(FailReading)
        }</span>

        <span class="cov0" title="0">return lista, nil</span>
}

func (r *repository) LastID() (int, error) <span class="cov0" title="0">{

        var lista []domain.Transaction
        if err := r.db.Read(&amp;lista); err != nil </span><span class="cov0" title="0">{
                return 0, fmt.Errorf(FailReading)
        }</span>

        <span class="cov0" title="0">if len(lista) == 0 </span><span class="cov0" title="0">{
                return 0, nil
        }</span>

        //var lastID int
        <span class="cov0" title="0">lastID := lista[len(lista)-1].Id

        return lastID, nil</span>
}

func (r *repository) Store(id int, tranCode, currency string, amount float64, transmitter, receiver, tranDate string) (domain.Transaction, error) <span class="cov0" title="0">{

        var lista []domain.Transaction

        t := domain.Transaction{
                Id:          id,
                TranCode:    tranCode,
                Currency:    currency,
                Amount:      amount,
                Transmitter: transmitter,
                Reciever:    receiver,
                TranDate:    tranCode,
        }

        if err := r.db.Read(&amp;lista); err != nil </span><span class="cov0" title="0">{
                return domain.Transaction{}, fmt.Errorf(FailReading)
        }</span>
        <span class="cov0" title="0">lista = append(lista, t)

        if err := r.db.Write(lista); err != nil </span><span class="cov0" title="0">{
                return domain.Transaction{}, fmt.Errorf(FailWriting, err)
        }</span>

        <span class="cov0" title="0">return t, nil</span>

        // Solución guardando en memorio local

        // lista = append(lista, t)
        // lastID = t.Id
        // return t, nil

}

// Función Update(PUT)

func (r *repository) Update(id int, tranCode, currency string, amount float64, transmitter, receiver, tranDate string) (domain.Transaction, error) <span class="cov8" title="1">{
        var lista []domain.Transaction
        if err := r.db.Read(&amp;lista); err != nil </span><span class="cov0" title="0">{
                return domain.Transaction{}, fmt.Errorf(FailReading)
        }</span>

        <span class="cov8" title="1">t := domain.Transaction{
                TranCode:    tranCode,
                Currency:    currency,
                Amount:      amount,
                Transmitter: transmitter,
                Reciever:    receiver,
                TranDate:    tranDate,
        }

        update := false
        for i := range lista </span><span class="cov8" title="1">{
                if lista[i].Id == id </span><span class="cov8" title="1">{
                        t.Id = id
                        lista[i] = t
                        update = true
                }</span>
        }

        <span class="cov8" title="1">if !update </span><span class="cov0" title="0">{
                return domain.Transaction{}, fmt.Errorf(ProductNotFound, id)
        }</span>

        <span class="cov8" title="1">if err := r.db.Write(lista); err != nil </span><span class="cov0" title="0">{
                return domain.Transaction{}, fmt.Errorf(FailWriting, err)
        }</span>

        <span class="cov8" title="1">return t, nil</span>
}

func (r *repository) Delete(id int) error <span class="cov8" title="1">{
        var lista []domain.Transaction
        if err := r.db.Read(&amp;lista); err != nil </span><span class="cov0" title="0">{
                return fmt.Errorf(FailReading)
        }</span>

        <span class="cov8" title="1">deleted := false
        var index int
        for i := range lista </span><span class="cov8" title="1">{
                if lista[i].Id == id </span><span class="cov8" title="1">{
                        index = i
                        deleted = true
                }</span>
        }

        <span class="cov8" title="1">if !deleted </span><span class="cov8" title="1">{
                return fmt.Errorf("Producto %d no encontrado", id)
        }</span>

        <span class="cov8" title="1">lista = append(lista[:index], lista[index+1:]...)

        if err := r.db.Write(lista); err != nil </span><span class="cov0" title="0">{
                return fmt.Errorf(FailWriting, err)
        }</span>

        <span class="cov8" title="1">return nil</span>
}

func (r *repository) UpdateCodeAmount(id int, tranCode string, amount float64) (domain.Transaction, error) <span class="cov0" title="0">{

        var lista []domain.Transaction
        if err := r.db.Read(&amp;lista); err != nil </span><span class="cov0" title="0">{
                return domain.Transaction{}, fmt.Errorf(FailReading)
        }</span>

        <span class="cov0" title="0">var t domain.Transaction
        update := false
        for i := range lista </span><span class="cov0" title="0">{
                if lista[i].Id == id </span><span class="cov0" title="0">{
                        lista[i].TranCode = tranCode
                        lista[i].Amount = amount
                        t = lista[i]
                        update = true
                }</span>
        }

        <span class="cov0" title="0">if !update </span><span class="cov0" title="0">{
                return domain.Transaction{}, fmt.Errorf("Producto %d no encontrado", id)
        }</span>

        <span class="cov0" title="0">if err := r.db.Write(lista); err != nil </span><span class="cov0" title="0">{
                return domain.Transaction{}, fmt.Errorf(FailWriting, err)
        }</span>

        <span class="cov0" title="0">return t, nil</span>

}
</pre>
		
		<pre class="file" id="file1" style="display: none">package transactions

import (
        "goweb/internal/domain"
)

type Service interface {
        GetAll() ([]domain.Transaction, error)
        Store(tranCode, currency string, amount float64, transmitter, receiver, tranDate string) (domain.Transaction, error)
        Update(id int, tranCode, currency string, amount float64, transmitter, receiver, tranDate string) (domain.Transaction, error)
        Delete(id int) error
        UpdateCodeAmount(id int, tranCode string, amount float64) (domain.Transaction, error)
}

type service struct {
        repository Repository
}

func NewService(r Repository) Service <span class="cov8" title="1">{
        return &amp;service{
                repository: r,
        }
}</span>

func (s *service) GetAll() ([]domain.Transaction, error) <span class="cov0" title="0">{
        lista, err := s.repository.GetAll()
        if err != nil </span><span class="cov0" title="0">{
                return nil, err
        }</span>
        <span class="cov0" title="0">return lista, nil</span>
}

func (s *service) Store(tranCode, currency string, amount float64, transmitter, receiver, tranDate string) (domain.Transaction, error) <span class="cov0" title="0">{
        lastId, err := s.repository.LastID()
        if err != nil </span><span class="cov0" title="0">{
                return domain.Transaction{}, nil
        }</span>

        <span class="cov0" title="0">lastId++

        transaction, err := s.repository.Store(lastId, tranCode, currency, amount, transmitter, receiver, tranDate)
        if err != nil </span><span class="cov0" title="0">{
                return domain.Transaction{}, nil
        }</span>

        <span class="cov0" title="0">return transaction, nil</span>
}

func (s *service) Update(id int, tranCode, currency string, amount float64, transmitter, receiver, tranDate string) (domain.Transaction, error) <span class="cov8" title="1">{

        return s.repository.Update(id, tranCode, currency, amount, transmitter, receiver, tranDate)

}</span>

func (s *service) Delete(id int) error <span class="cov8" title="1">{

        return s.repository.Delete(id)

}</span>

func (s *service) UpdateCodeAmount(id int, tranCode string, amount float64) (domain.Transaction, error) <span class="cov0" title="0">{

        return s.repository.UpdateCodeAmount(id, tranCode, amount)

}</span>
</pre>
		
		</div>
	</body>
	<script>
	(function() {
		var files = document.getElementById('files');
		var visible;
		files.addEventListener('change', onChange, false);
		function select(part) {
			if (visible)
				visible.style.display = 'none';
			visible = document.getElementById(part);
			if (!visible)
				return;
			files.value = part;
			visible.style.display = 'block';
			location.hash = part;
		}
		function onChange() {
			select(files.value);
			window.scrollTo(0, 0);
		}
		if (location.hash != "") {
			select(location.hash.substr(1));
		}
		if (!visible) {
			select("file0");
		}
	})();
	</script>
</html>
